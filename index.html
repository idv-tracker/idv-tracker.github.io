<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¬¬äº”äººæ ¼ å‹ç‡è¨ˆç®—ã‚¢ãƒ—ãƒª</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
      color: white;
      padding: 25px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    
    .perspective-tabs {
      display: flex;
      background: #f8f9fa;
      border-bottom: 2px solid #e0e0e0;
    }
    
    .perspective-tab {
      flex: 1;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      background: #f8f9fa;
      border: none;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .perspective-tab.active {
      background: white;
      color: #0f3460;
      border-bottom: 3px solid #0f3460;
    }
    
    .perspective-tab:hover {
      background: #e9ecef;
    }
    
    .main-tabs {
      display: flex;
      background: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      overflow-x: auto;
    }
    
    .main-tab {
      padding: 12px 20px;
      cursor: pointer;
      background: #f8f9fa;
      border: none;
      font-size: 14px;
      white-space: nowrap;
      transition: all 0.3s;
    }
    
    .main-tab.active {
      background: white;
      color: #0f3460;
      border-bottom: 2px solid #0f3460;
    }
    
    .main-tab:hover {
      background: #e9ecef;
    }
    
    .content {
      padding: 25px;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }
    
    select {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
    }
    
    select:focus {
      outline: none;
      border-color: #0f3460;
    }
    
    .character-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .result-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    
    .result-button {
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .result-button:hover {
      border-color: #0f3460;
      background: #e6f0ff;
    }
    
    .result-button.selected {
      background: #0f3460;
      color: white;
      border-color: #0f3460;
    }
    
    .submit-button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #0f3460 0%, #533483 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
      transition: transform 0.2s;
    }
    
    .submit-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(15, 52, 96, 0.4);
    }
    
    .submit-button:active {
      transform: translateY(0);
    }
    
    .stats-card {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .stats-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      color: #333;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }
    
    .stat-item {
      background: white;
      padding: 15px;
      border-radius: 6px;
      border-left: 4px solid #0f3460;
    }
    
    .stat-name {
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #0f3460;
    }
    
    .stat-detail {
      font-size: 12px;
      color: #999;
      margin-top: 5px;
    }
    
    .match-history {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      overflow: hidden;
    }
    
    .match-item {
      padding: 15px;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .match-item:last-child {
      border-bottom: none;
    }
    
    .match-info {
      flex: 1;
    }
    
    .match-result {
      padding: 5px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 10px;
    }
    
    .match-result.win {
      background: #d4edda;
      color: #155724;
    }
    
    .match-result.lose {
      background: #f8d7da;
      color: #721c24;
    }
    
    .match-result.draw {
      background: #fff3cd;
      color: #856404;
    }
    
    .match-actions button {
      margin-left: 5px;
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .edit-button {
      background: #ffc107;
      color: #000;
    }
    
    .delete-button {
      background: #dc3545;
      color: white;
    }
    
    .reset-button {
      background: #dc3545;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 20px;
    }
    
    .reset-button:hover {
      background: #c82333;
    }
    
    .chart-container {
      margin: 20px 0;
      padding: 15px;
      background: white;
      border-radius: 6px;
      border: 1px solid #dee2e6;
    }
    
    .bar-chart {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .bar-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .bar-label {
      min-width: 120px;
      font-size: 13px;
      font-weight: 500;
    }
    
    .bar-wrapper {
      flex: 1;
      height: 30px;
      background: #e9ecef;
      border-radius: 4px;
      position: relative;
      overflow: hidden;
    }
    
    .bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #0f3460 0%, #533483 100%);
      border-radius: 4px;
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 8px;
      color: white;
      font-size: 12px;
      font-weight: 600;
    }
    
    .bar-stats {
      min-width: 100px;
      text-align: right;
      font-size: 12px;
      color: #666;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #999;
    }
    
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ç¬¬äº”äººæ ¼ å‹ç‡è¨ˆç®—ã‚¢ãƒ—ãƒª</h1>
    </div>
    
    <div class="perspective-tabs">
      <button class="perspective-tab active" onclick="switchPerspective('survivor')">ã‚µãƒã‚¤ãƒãƒ¼è¦–ç‚¹</button>
      <button class="perspective-tab" onclick="switchPerspective('hunter')">ãƒãƒ³ã‚¿ãƒ¼è¦–ç‚¹</button>
    </div>
    
    <div class="main-tabs">
      <button class="main-tab active" onclick="switchTab('input')">è©¦åˆå…¥åŠ›</button>
      <button class="main-tab" onclick="switchTab('overall')">ç·åˆå‹ç‡</button>
      <button class="main-tab" onclick="switchTab('character')">è‡ªã‚­ãƒ£ãƒ©åˆ¥å‹ç‡</button>
      <button class="main-tab" onclick="switchTab('map')">ãƒãƒƒãƒ—åˆ¥å‹ç‡</button>
      <button class="main-tab" onclick="switchTab('opponent')">å¯¾æˆ¦ç›¸æ‰‹åˆ¥å‹ç‡</button>
      <button class="main-tab" onclick="switchTab('history')">è©¦åˆå±¥æ­´</button>
    </div>
    
    <div class="content">
      <!-- è©¦åˆå…¥åŠ›ã‚¿ãƒ– -->
      <div id="input-tab" class="tab-content active">
        <div id="survivor-input">
          <div class="form-group">
            <label class="form-label">è‡ªåˆ†ã®ã‚µãƒã‚¤ãƒãƒ¼</label>
            <select id="my-survivor">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">å‘³æ–¹ã‚µãƒã‚¤ãƒãƒ¼1</label>
            <select id="teammate-1">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">å‘³æ–¹ã‚µãƒã‚¤ãƒãƒ¼2</label>
            <select id="teammate-2">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">å‘³æ–¹ã‚µãƒã‚¤ãƒãƒ¼3</label>
            <select id="teammate-3">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">ç›¸æ‰‹ãƒãƒ³ã‚¿ãƒ¼</label>
            <select id="opponent-hunter">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">ãƒãƒƒãƒ—</label>
            <select id="survivor-map">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">è„±å‡ºäººæ•°</label>
            <div class="result-buttons" style="grid-template-columns: repeat(5, 1fr);">
              <button class="result-button" onclick="selectEscapeCount('survivor', 0)">0äºº</button>
              <button class="result-button" onclick="selectEscapeCount('survivor', 1)">1äºº</button>
              <button class="result-button" onclick="selectEscapeCount('survivor', 2)">2äºº</button>
              <button class="result-button" onclick="selectEscapeCount('survivor', 3)">3äºº</button>
              <button class="result-button" onclick="selectEscapeCount('survivor', 4)">4äºº</button>
            </div>
          </div>
          
          <button class="submit-button" onclick="submitMatch('survivor')">è©¦åˆã‚’è¨˜éŒ²</button>
        </div>
        
        <div id="hunter-input" style="display: none;">
          <div class="form-group">
            <label class="form-label">è‡ªåˆ†ã®ãƒãƒ³ã‚¿ãƒ¼</label>
            <select id="my-hunter">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">ç›¸æ‰‹ã‚µãƒã‚¤ãƒãƒ¼1</label>
            <select id="opponent-survivor-1">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">ç›¸æ‰‹ã‚µãƒã‚¤ãƒãƒ¼2</label>
            <select id="opponent-survivor-2">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">ç›¸æ‰‹ã‚µãƒã‚¤ãƒãƒ¼3</label>
            <select id="opponent-survivor-3">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">ç›¸æ‰‹ã‚µãƒã‚¤ãƒãƒ¼4</label>
            <select id="opponent-survivor-4">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">ãƒãƒƒãƒ—</label>
            <select id="hunter-map">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">è„±å‡ºäººæ•°</label>
            <div class="result-buttons" style="grid-template-columns: repeat(5, 1fr);">
              <button class="result-button" onclick="selectEscapeCount('hunter', 0)">0äºº</button>
              <button class="result-button" onclick="selectEscapeCount('hunter', 1)">1äºº</button>
              <button class="result-button" onclick="selectEscapeCount('hunter', 2)">2äºº</button>
              <button class="result-button" onclick="selectEscapeCount('hunter', 3)">3äºº</button>
              <button class="result-button" onclick="selectEscapeCount('hunter', 4)">4äºº</button>
            </div>
          </div>
          
          <button class="submit-button" onclick="submitMatch('hunter')">è©¦åˆã‚’è¨˜éŒ²</button>
        </div>
      </div>
      
      <!-- ç·åˆå‹ç‡ã‚¿ãƒ– -->
      <div id="overall-tab" class="tab-content">
        <div id="overall-stats"></div>
      </div>
      
      <!-- è‡ªã‚­ãƒ£ãƒ©åˆ¥å‹ç‡ã‚¿ãƒ– -->
      <div id="character-tab" class="tab-content">
        <div id="character-stats"></div>
      </div>
      
      <!-- ãƒãƒƒãƒ—åˆ¥å‹ç‡ã‚¿ãƒ– -->
      <div id="map-tab" class="tab-content">
        <div id="map-stats"></div>
      </div>
      
      <!-- å¯¾æˆ¦ç›¸æ‰‹åˆ¥å‹ç‡ã‚¿ãƒ– -->
      <div id="opponent-tab" class="tab-content">
        <div id="opponent-stats"></div>
      </div>
      
      <!-- è©¦åˆå±¥æ­´ã‚¿ãƒ– -->
      <div id="history-tab" class="tab-content">
        <div id="match-history"></div>
        <button class="reset-button" onclick="resetAllData()">å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    </div>
  </div>

  <script>
    const SURVIVORS = ['å¹¸é‹å…', 'åŒ»å¸«', 'å¼è­·å£«', 'æ³¥æ£’', 'åº­å¸«', 'ãƒã‚¸ã‚·ãƒ£ãƒ³', 'å†’é™ºå®¶', 'å‚­å…µ', 'ç¥­å¸', 'ç©ºè»', 'æ©Ÿæ¢°æŠ€å¸«', 'ã‚ªãƒ•ã‚§ãƒ³ã‚¹', 'å¿ƒçœ¼', 'èª¿é¦™å¸«', 'ã‚«ã‚¦ãƒœãƒ¼ã‚¤', 'è¸Šã‚Šå­', 'å ã„å¸«', 'ç´æ£ºå¸«', 'æ¢é‰±è€…', 'å‘ªè¡“å¸«', 'é‡äºº', 'æ›²èŠ¸å¸«', 'ä¸€ç­‰èˆªæµ·å£«', 'ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰', 'ãƒã‚¹ãƒˆãƒãƒ³', 'å¢“å®ˆ', 'ã€Œå›šäººã€', 'æ˜†è™«å­¦è€…', 'ç”»å®¶', 'ãƒãƒƒãƒ„ãƒãƒ³', 'ç©å…·è·äºº', 'æ‚£è€…', 'ã€Œå¿ƒç†å­¦è€…ã€', 'å°èª¬å®¶', 'ã€Œå°‘å¥³ã€', 'æ³£ããƒ”ã‚¨ãƒ­', 'æ•™æˆ', 'éª¨è‘£å•†', 'ä½œæ›²å®¶', 'è¨˜è€…', 'èˆªç©ºã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢', 'å¿œæ´å›£', 'äººå½¢å¸«', 'ç«ç½èª¿æŸ»å“¡', 'ã€Œãƒ¬ãƒ‡ã‚£ãƒ»ãƒ•ã‚¡ã‚¦ãƒ­ã€', 'ã€Œé¨å£«ã€', 'æ°—è±¡å­¦è€…', 'å¼“ä½¿ã„', 'ã€Œè„±å‡ºãƒã‚¹ã‚¿ãƒ¼ã€', 'å¹»ç¯å¸«', 'é—˜ç‰›å£«'];
    
    const HUNTERS = ['å¾©è®è€…', 'é“åŒ–å¸«', 'æ–­ç½ªç‹©äºº', 'ãƒªãƒƒãƒ‘ãƒ¼', 'çµé­‚è€…', 'èŠ¸è€…', 'ç™½é»’ç„¡å¸¸', 'å†™çœŸå®¶', 'ç‹‚çœ¼', 'é»„è¡£ã®ç‹', 'å¤¢ã®é­”å¥³', 'æ³£ãè™«', 'é­”ãƒˆã‚«ã‚²', 'è¡€ã®å¥³ç‹', 'ã‚¬ãƒ¼ãƒ‰No.26', 'ã€Œä½¿å¾’ã€', 'ãƒ´ã‚¡ã‚¤ã‚ªãƒªãƒ‹ã‚¹ãƒˆ', 'å½«åˆ»å¸«', 'ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰', 'ç ´è¼ª', 'æ¼å¸«', 'è‹äººå½¢å¸«', 'ã€Œæ‚ªå¤¢ã€', 'æ›¸è¨˜å®˜', 'éš è€…', 'å¤œã®ç•ªäºº', 'ã‚ªãƒšãƒ©æ­Œæ‰‹', 'ã€Œãƒ•ãƒ¼ãƒ«ã‚ºãƒ»ã‚´ãƒ¼ãƒ«ãƒ‰ã€', 'æ™‚ç©ºã®å½±', 'ã€Œè¶³èãˆã®ç¾Šã€', 'ã€Œãƒ•ãƒ©ãƒãƒ«ãƒ¼ã€', 'é›‘è²¨å•†', 'ã€Œãƒ“ãƒªãƒ¤ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€', 'ã€Œå¥³ç‹èœ‚ã€'];
    
    const MAPS = ['è»éœ€å·¥å ´', 'èµ¤ã®æ•™ä¼š', 'è–å¿ƒç—…é™¢', 'æ¹–æ™¯æ‘', 'æœˆã®æ²³å…¬åœ’', 'ãƒ¬ã‚ªã®æ€ã„å‡º', 'æ°¸çœ ç”º', 'ä¸­è¯è¡—', 'ç½ªã®æ£®'];
    
    let currentPerspective = 'survivor';
    let selectedEscapeCount = { survivor: null, hunter: null };
    let matches = [];
    let editingMatchId = null;
    
    // åˆæœŸåŒ–
    function init() {
      loadData();
      populateSelects();
      updateAllStats();
    }
    
    // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
    function populateSelects() {
      const survivorSelects = ['my-survivor', 'teammate-1', 'teammate-2', 'teammate-3', 'opponent-survivor-1', 'opponent-survivor-2', 'opponent-survivor-3', 'opponent-survivor-4'];
      survivorSelects.forEach(id => {
        const select = document.getElementById(id);
        SURVIVORS.forEach(survivor => {
          const option = document.createElement('option');
          option.value = survivor;
          option.textContent = survivor;
          select.appendChild(option);
        });
      });
      
      const hunterSelects = ['my-hunter', 'opponent-hunter'];
      hunterSelects.forEach(id => {
        const select = document.getElementById(id);
        HUNTERS.forEach(hunter => {
          const option = document.createElement('option');
          option.value = hunter;
          option.textContent = hunter;
          select.appendChild(option);
        });
      });
      
      const mapSelects = ['survivor-map', 'hunter-map'];
      mapSelects.forEach(id => {
        const select = document.getElementById(id);
        MAPS.forEach(map => {
          const option = document.createElement('option');
          option.value = map;
          option.textContent = map;
          select.appendChild(option);
        });
      });
    }
    
    // è¦–ç‚¹ã‚’åˆ‡ã‚Šæ›¿ãˆ
    function switchPerspective(perspective) {
      currentPerspective = perspective;
      
      document.querySelectorAll('.perspective-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');
      
      if (perspective === 'survivor') {
        document.getElementById('survivor-input').style.display = 'block';
        document.getElementById('hunter-input').style.display = 'none';
      } else {
        document.getElementById('survivor-input').style.display = 'none';
        document.getElementById('hunter-input').style.display = 'block';
      }
      
      updateAllStats();
    }
    
    // ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆ
    function switchTab(tabName) {
      document.querySelectorAll('.main-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');
      
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(tabName + '-tab').classList.add('active');
      
      updateAllStats();
    }
    
    // è„±å‡ºäººæ•°ã‚’é¸æŠ
    function selectEscapeCount(perspective, count) {
      selectedEscapeCount[perspective] = count;
      
      const container = perspective === 'survivor' ? document.getElementById('survivor-input') : document.getElementById('hunter-input');
      container.querySelectorAll('.result-button').forEach(btn => {
        btn.classList.remove('selected');
      });
      event.target.classList.add('selected');
    }
    
    // è„±å‡ºäººæ•°ã‹ã‚‰å‹æ•—ã‚’åˆ¤å®š
    function getResultFromEscapeCount(escapeCount, perspective) {
      if (perspective === 'survivor') {
        if (escapeCount >= 3) return 'survivor_win';
        if (escapeCount === 2) return 'draw';
        return 'hunter_win';
      } else {
        if (escapeCount <= 1) return 'hunter_win';
        if (escapeCount === 2) return 'draw';
        return 'survivor_win';
      }
    }
    
    // è©¦åˆã‚’è¨˜éŒ²
    function submitMatch(perspective) {
      let match = {
        id: editingMatchId || Date.now(),
        perspective: perspective,
        timestamp: new Date().toISOString()
      };
      
      if (perspective === 'survivor') {
        const mySurvivor = document.getElementById('my-survivor').value;
        const teammate1 = document.getElementById('teammate-1').value;
        const teammate2 = document.getElementById('teammate-2').value;
        const teammate3 = document.getElementById('teammate-3').value;
        const opponentHunter = document.getElementById('opponent-hunter').value;
        const map = document.getElementById('survivor-map').value;
        const escapeCount = selectedEscapeCount.survivor;
        
        if (!mySurvivor || !teammate1 || !teammate2 || !teammate3 || !opponentHunter || !map || escapeCount === null) {
          alert('å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
        
        const teammates = [teammate1, teammate2, teammate3];
        if (teammates.includes(mySurvivor)) {
          alert('è‡ªåˆ†ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¨å‘³æ–¹ãŒé‡è¤‡ã—ã¦ã„ã¾ã™');
          return;
        }
        if (new Set(teammates).size !== teammates.length) {
          alert('å‘³æ–¹ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒé‡è¤‡ã—ã¦ã„ã¾ã™');
          return;
        }
        
        match.myCharacter = mySurvivor;
        match.teammates = teammates;
        match.opponentHunter = opponentHunter;
        match.map = map;
        match.escapeCount = escapeCount;
        match.result = getResultFromEscapeCount(escapeCount, perspective);
      } else {
        const myHunter = document.getElementById('my-hunter').value;
        const opponentSurvivor1 = document.getElementById('opponent-survivor-1').value;
        const opponentSurvivor2 = document.getElementById('opponent-survivor-2').value;
        const opponentSurvivor3 = document.getElementById('opponent-survivor-3').value;
        const opponentSurvivor4 = document.getElementById('opponent-survivor-4').value;
        const map = document.getElementById('hunter-map').value;
        const escapeCount = selectedEscapeCount.hunter;
        
        if (!myHunter || !opponentSurvivor1 || !opponentSurvivor2 || !opponentSurvivor3 || !opponentSurvivor4 || !map || escapeCount === null) {
          alert('å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
        
        const opponents = [opponentSurvivor1, opponentSurvivor2, opponentSurvivor3, opponentSurvivor4];
        if (new Set(opponents).size !== opponents.length) {
          alert('ç›¸æ‰‹ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒé‡è¤‡ã—ã¦ã„ã¾ã™');
          return;
        }
        
        match.myCharacter = myHunter;
        match.opponentSurvivors = opponents;
        match.map = map;
        match.escapeCount = escapeCount;
        match.result = getResultFromEscapeCount(escapeCount, perspective);
      }
      
      if (editingMatchId) {
        matches = matches.filter(m => m.id !== editingMatchId);
        editingMatchId = null;
      }
      
      matches.push(match);
      saveData();
      resetForm(perspective);
      alert('è©¦åˆã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼');
      updateAllStats();
    }
    
    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
    function resetForm(perspective) {
      if (perspective === 'survivor') {
        document.getElementById('my-survivor').value = '';
        document.getElementById('teammate-1').value = '';
        document.getElementById('teammate-2').value = '';
        document.getElementById('teammate-3').value = '';
        document.getElementById('opponent-hunter').value = '';
        document.getElementById('survivor-map').value = '';
        selectedEscapeCount.survivor = null;
        document.querySelectorAll('#survivor-input .result-button').forEach(btn => {
          btn.classList.remove('selected');
        });
      } else {
        document.getElementById('my-hunter').value = '';
        document.getElementById('opponent-survivor-1').value = '';
        document.getElementById('opponent-survivor-2').value = '';
        document.getElementById('opponent-survivor-3').value = '';
        document.getElementById('opponent-survivor-4').value = '';
        document.getElementById('hunter-map').value = '';
        selectedEscapeCount.hunter = null;
        document.querySelectorAll('#hunter-input .result-button').forEach(btn => {
          btn.classList.remove('selected');
        });
      }
    }
    
    // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
    function saveData() {
      localStorage.setItem('identity5_matches', JSON.stringify(matches));
    }
    
    // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
    function loadData() {
      const saved = localStorage.getItem('identity5_matches');
      if (saved) {
        matches = JSON.parse(saved);
      }
    }
    
    // å…¨ã¦ã®çµ±è¨ˆã‚’æ›´æ–°
    function updateAllStats() {
      updateOverallStats();
      updateCharacterStats();
      updateMapStats();
      updateOpponentStats();
      updateMatchHistory();
    }
    
    // å‹ç‡ã‚’è¨ˆç®—
    function calculateWinrate(matches, perspective) {
      const filtered = matches.filter(m => m.result !== 'draw');
      if (filtered.length === 0) return { wins: 0, losses: 0, draws: 0, winrate: 0, total: 0 };
      
      const wins = filtered.filter(m => {
        if (perspective === 'survivor') {
          return m.result === 'survivor_win';
        } else {
          return m.result === 'hunter_win';
        }
      }).length;
      
      const losses = filtered.length - wins;
      const draws = matches.filter(m => m.result === 'draw').length;
      const winrate = (wins / filtered.length * 100).toFixed(1);
      
      return { wins, losses, draws, winrate, total: matches.length };
    }
    
    // ç·åˆå‹ç‡ã‚’æ›´æ–°
    function updateOverallStats() {
      const container = document.getElementById('overall-stats');
      const perspectiveMatches = matches.filter(m => m.perspective === currentPerspective);
      
      if (perspectiveMatches.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“Š</div><p>ã¾ã è©¦åˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p></div>';
        return;
      }
      
      const stats = calculateWinrate(perspectiveMatches, currentPerspective);
      
      container.innerHTML = `
        <div class="stats-card">
          <div class="stats-title">ç·åˆå‹ç‡ï¼ˆ${currentPerspective === 'survivor' ? 'ã‚µãƒã‚¤ãƒãƒ¼è¦–ç‚¹' : 'ãƒãƒ³ã‚¿ãƒ¼è¦–ç‚¹'}ï¼‰</div>
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-name">ç·è©¦åˆæ•°</div>
              <div class="stat-value">${stats.total}</div>
            </div>
            <div class="stat-item">
              <div class="stat-name">å‹åˆ©æ•°</div>
              <div class="stat-value">${stats.wins}</div>
            </div>
            <div class="stat-item">
              <div class="stat-name">æ•—åŒ—æ•°</div>
              <div class="stat-value">${stats.losses}</div>
            </div>
            <div class="stat-item">
              <div class="stat-name">å¼•ãåˆ†ã‘</div>
              <div class="stat-value">${stats.draws}</div>
            </div>
            <div class="stat-item">
              <div class="stat-name">å‹ç‡ï¼ˆå¼•ãåˆ†ã‘é™¤ãï¼‰</div>
              <div class="stat-value">${stats.winrate}%</div>
              <div class="stat-detail">${stats.wins}å‹ ${stats.losses}æ•—</div>
            </div>
          </div>
        </div>
      `;
    }
    
    // è‡ªã‚­ãƒ£ãƒ©åˆ¥å‹ç‡ã‚’æ›´æ–°
    function updateCharacterStats() {
      const container = document.getElementById('character-stats');
      const perspectiveMatches = matches.filter(m => m.perspective === currentPerspective);
      
      if (perspectiveMatches.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ­</div><p>ã¾ã è©¦åˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p></div>';
        return;
      }
      
      const characterStats = {};
      
      perspectiveMatches.forEach(match => {
        const char = match.myCharacter;
        if (!characterStats[char]) {
          characterStats[char] = [];
        }
        characterStats[char].push(match);
      });
      
      const sortedChars = Object.keys(characterStats).sort((a, b) => {
        const statsA = calculateWinrate(characterStats[a], currentPerspective);
        const statsB = calculateWinrate(characterStats[b], currentPerspective);
        return parseFloat(statsB.winrate) - parseFloat(statsA.winrate);
      });
      
      let html = `<div class="stats-card">
        <div class="stats-title">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¥å‹ç‡ï¼ˆ${currentPerspective === 'survivor' ? 'ã‚µãƒã‚¤ãƒãƒ¼' : 'ãƒãƒ³ã‚¿ãƒ¼'}ï¼‰</div>
        <div class="stats-grid">`;
      
      sortedChars.forEach(char => {
        const stats = calculateWinrate(characterStats[char], currentPerspective);
        html += `
          <div class="stat-item">
            <div class="stat-name">${char}</div>
            <div class="stat-value">${stats.winrate}%</div>
            <div class="stat-detail">${stats.wins}å‹ ${stats.losses}æ•— ${stats.draws}åˆ† (${stats.total}è©¦åˆ)</div>
          </div>
        `;
      });
      
      html += '</div></div>';
      container.innerHTML = html;
    }
    
    // ãƒãƒƒãƒ—åˆ¥å‹ç‡ã‚’æ›´æ–°
    function updateMapStats() {
      const container = document.getElementById('map-stats');
      const perspectiveMatches = matches.filter(m => m.perspective === currentPerspective);
      
      if (perspectiveMatches.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ—ºï¸</div><p>ã¾ã è©¦åˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p></div>';
        return;
      }
      
      const mapStats = {};
      
      perspectiveMatches.forEach(match => {
        const map = match.map;
        if (!mapStats[map]) {
          mapStats[map] = [];
        }
        mapStats[map].push(match);
      });
      
      const sortedMaps = Object.keys(mapStats).sort((a, b) => {
        const statsA = calculateWinrate(mapStats[a], currentPerspective);
        const statsB = calculateWinrate(mapStats[b], currentPerspective);
        return parseFloat(statsB.winrate) - parseFloat(statsA.winrate);
      });
      
      let html = `<div class="stats-card">
        <div class="stats-title">ãƒãƒƒãƒ—åˆ¥å‹ç‡</div>
        <div class="stats-grid">`;
      
      sortedMaps.forEach(map => {
        const stats = calculateWinrate(mapStats[map], currentPerspective);
        html += `
          <div class="stat-item">
            <div class="stat-name">${map}</div>
            <div class="stat-value">${stats.winrate}%</div>
            <div class="stat-detail">${stats.wins}å‹ ${stats.losses}æ•— ${stats.draws}åˆ† (${stats.total}è©¦åˆ)</div>
          </div>
        `;
      });
      
      html += '</div></div>';
      container.innerHTML = html;
    }
    
    // å¯¾æˆ¦ç›¸æ‰‹åˆ¥å‹ç‡ã‚’æ›´æ–°
    function updateOpponentStats() {
      const container = document.getElementById('opponent-stats');
      const perspectiveMatches = matches.filter(m => m.perspective === currentPerspective);
      
      if (perspectiveMatches.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">âš”ï¸</div><p>ã¾ã è©¦åˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p></div>';
        return;
      }
      
      if (currentPerspective === 'survivor') {
        // ã‚µãƒã‚¤ãƒãƒ¼è¦–ç‚¹: ç›¸æ‰‹ãƒãƒ³ã‚¿ãƒ¼åˆ¥ã¨å‘³æ–¹ç·¨æˆåˆ¥
        const hunterStats = {};
        const teammateStats = {};
        
        perspectiveMatches.forEach(match => {
          // ç›¸æ‰‹ãƒãƒ³ã‚¿ãƒ¼åˆ¥
          const hunter = match.opponentHunter;
          if (!hunterStats[hunter]) {
            hunterStats[hunter] = [];
          }
          hunterStats[hunter].push(match);
          
          // å‘³æ–¹ç·¨æˆåˆ¥
          match.teammates.forEach(teammate => {
            if (!teammateStats[teammate]) {
              teammateStats[teammate] = [];
            }
            teammateStats[teammate].push(match);
          });
        });
        
        let html = `<div class="stats-card">
          <div class="stats-title">å¯¾æˆ¦ç›¸æ‰‹ãƒãƒ³ã‚¿ãƒ¼åˆ¥å‹ç‡</div>
          <div class="stats-grid">`;
        
        Object.keys(hunterStats).sort((a, b) => {
          const statsA = calculateWinrate(hunterStats[a], currentPerspective);
          const statsB = calculateWinrate(hunterStats[b], currentPerspective);
          return parseFloat(statsB.winrate) - parseFloat(statsA.winrate);
        }).forEach(hunter => {
          const stats = calculateWinrate(hunterStats[hunter], currentPerspective);
          html += `
            <div class="stat-item">
              <div class="stat-name">vs ${hunter}</div>
              <div class="stat-value">${stats.winrate}%</div>
              <div class="stat-detail">${stats.wins}å‹ ${stats.losses}æ•— ${stats.draws}åˆ† (${stats.total}è©¦åˆ)</div>
            </div>
          `;
        });
        
        html += `</div></div>
          <div class="stats-card">
            <div class="stats-title">å‘³æ–¹ç·¨æˆåˆ¥å‹ç‡ï¼ˆã‚°ãƒ©ãƒ•ï¼‰</div>
            <div class="chart-container">
              <div class="bar-chart">`;
        
        const sortedTeammates = Object.keys(teammateStats).sort((a, b) => {
          return teammateStats[b].length - teammateStats[a].length;
        });
        
        sortedTeammates.forEach(teammate => {
          const stats = calculateWinrate(teammateStats[teammate], currentPerspective);
          const winrateNum = parseFloat(stats.winrate) || 0;
          html += `
            <div class="bar-item">
              <div class="bar-label">${teammate}</div>
              <div class="bar-wrapper">
                <div class="bar-fill" style="width: ${winrateNum}%">${stats.winrate}%</div>
              </div>
              <div class="bar-stats">${stats.wins}å‹${stats.losses}æ•— (${stats.total}è©¦åˆ)</div>
            </div>
          `;
        });
        
        html += '</div></div></div>';
        container.innerHTML = html;
        
      } else {
        // ãƒãƒ³ã‚¿ãƒ¼è¦–ç‚¹: ç›¸æ‰‹ã‚µãƒã‚¤ãƒãƒ¼åˆ¥
        const survivorStats = {};
        
        perspectiveMatches.forEach(match => {
          match.opponentSurvivors.forEach(survivor => {
            if (!survivorStats[survivor]) {
              survivorStats[survivor] = [];
            }
            survivorStats[survivor].push(match);
          });
        });
        
        let html = `<div class="stats-card">
          <div class="stats-title">å¯¾æˆ¦ç›¸æ‰‹ã‚µãƒã‚¤ãƒãƒ¼åˆ¥å‹ç‡ï¼ˆã‚°ãƒ©ãƒ•ï¼‰</div>
          <div class="chart-container">
            <div class="bar-chart">`;
        
        const sortedSurvivors = Object.keys(survivorStats).sort((a, b) => {
          return survivorStats[b].length - survivorStats[a].length;
        });
        
        sortedSurvivors.forEach(survivor => {
          const stats = calculateWinrate(survivorStats[survivor], currentPerspective);
          const winrateNum = parseFloat(stats.winrate) || 0;
          html += `
            <div class="bar-item">
              <div class="bar-label">${survivor}</div>
              <div class="bar-wrapper">
                <div class="bar-fill" style="width: ${winrateNum}%">${stats.winrate}%</div>
              </div>
              <div class="bar-stats">${stats.wins}å‹${stats.losses}æ•— (${stats.total}è©¦åˆ)</div>
            </div>
          `;
        });
        
        html += '</div></div></div>';
        container.innerHTML = html;
      }
    }
    
    // è©¦åˆå±¥æ­´ã‚’æ›´æ–°
    function updateMatchHistory() {
      const container = document.getElementById('match-history');
      const perspectiveMatches = matches.filter(m => m.perspective === currentPerspective).reverse();
      
      if (perspectiveMatches.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“</div><p>ã¾ã è©¦åˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p></div>';
        return;
      }
      
      let html = '<div class="match-history">';
      
      perspectiveMatches.forEach(match => {
        const resultClass = match.result === 'survivor_win' ? 'win' : match.result === 'hunter_win' ? 'lose' : 'draw';
        const resultText = match.result === 'survivor_win' ? 'ã‚µãƒã‚¤ãƒãƒ¼å‹åˆ©' : match.result === 'hunter_win' ? 'ãƒãƒ³ã‚¿ãƒ¼å‹åˆ©' : 'å¼•ãåˆ†ã‘';
        const isWin = (currentPerspective === 'survivor' && match.result === 'survivor_win') || 
                      (currentPerspective === 'hunter' && match.result === 'hunter_win');
        const displayResultClass = isWin ? 'win' : match.result === 'draw' ? 'draw' : 'lose';
        const escapeInfo = match.escapeCount !== undefined ? ` (è„±å‡º${match.escapeCount}äºº)` : '';
        
        let details = '';
        if (match.perspective === 'survivor') {
          details = `${match.myCharacter} + ${match.teammates.join(', ')} vs ${match.opponentHunter} @ ${match.map}${escapeInfo}`;
        } else {
          details = `${match.myCharacter} vs ${match.opponentSurvivors.join(', ')} @ ${match.map}${escapeInfo}`;
        }
        
        html += `
          <div class="match-item">
            <div class="match-info">
              <span class="match-result ${displayResultClass}">${resultText}</span>
              <span>${details}</span>
            </div>
            <div class="match-actions">
              <button class="edit-button" onclick="editMatch(${match.id})">ç·¨é›†</button>
              <button class="delete-button" onclick="deleteMatch(${match.id})">å‰Šé™¤</button>
            </div>
          </div>
        `;
      });
      
      html += '</div>';
      container.innerHTML = html;
    }
    
    // è©¦åˆã‚’ç·¨é›†
    function editMatch(id) {
      const match = matches.find(m => m.id === id);
      if (!match) return;
      
      editingMatchId = id;
      
      if (match.perspective === 'survivor') {
        currentPerspective = 'survivor';
        document.getElementById('my-survivor').value = match.myCharacter;
        document.getElementById('teammate-1').value = match.teammates[0];
        document.getElementById('teammate-2').value = match.teammates[1];
        document.getElementById('teammate-3').value = match.teammates[2];
        document.getElementById('opponent-hunter').value = match.opponentHunter;
        document.getElementById('survivor-map').value = match.map;
        selectedEscapeCount.survivor = match.escapeCount !== undefined ? match.escapeCount : null;
        
        document.querySelectorAll('.perspective-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.perspective-tab')[0].classList.add('active');
        document.getElementById('survivor-input').style.display = 'block';
        document.getElementById('hunter-input').style.display = 'none';
        
        document.querySelectorAll('#survivor-input .result-button').forEach((btn, index) => {
          btn.classList.remove('selected');
          if (match.escapeCount !== undefined && index === match.escapeCount) {
            btn.classList.add('selected');
          }
        });
      } else {
        currentPerspective = 'hunter';
        document.getElementById('my-hunter').value = match.myCharacter;
        document.getElementById('opponent-survivor-1').value = match.opponentSurvivors[0];
        document.getElementById('opponent-survivor-2').value = match.opponentSurvivors[1];
        document.getElementById('opponent-survivor-3').value = match.opponentSurvivors[2];
        document.getElementById('opponent-survivor-4').value = match.opponentSurvivors[3];
        document.getElementById('hunter-map').value = match.map;
        selectedEscapeCount.hunter = match.escapeCount !== undefined ? match.escapeCount : null;
        
        document.querySelectorAll('.perspective-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.perspective-tab')[1].classList.add('active');
        document.getElementById('survivor-input').style.display = 'none';
        document.getElementById('hunter-input').style.display = 'block';
        
        document.querySelectorAll('#hunter-input .result-button').forEach((btn, index) => {
          btn.classList.remove('selected');
          if (match.escapeCount !== undefined && index === match.escapeCount) {
            btn.classList.add('selected');
          }
        });
      }
      
      // è©¦åˆå…¥åŠ›ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
      document.querySelectorAll('.main-tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.main-tab')[0].classList.add('active');
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById('input-tab').classList.add('active');
      
      window.scrollTo(0, 0);
    }
    
    // è©¦åˆã‚’å‰Šé™¤
    function deleteMatch(id) {
      if (!confirm('ã“ã®è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
      
      matches = matches.filter(m => m.id !== id);
      saveData();
      updateAllStats();
      alert('è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
    }
    
    // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
    function resetAllData() {
      if (!confirm('æœ¬å½“ã«å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;
      
      matches = [];
      saveData();
      updateAllStats();
      alert('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
    }
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
